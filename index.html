<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Geometry Dash — V3 Modern Mobile-Friendly</title>
<style>
  html,body{height:100%;margin:0;background:#05060d;font-family:Inter, Arial, sans-serif;}
  canvas{display:block;margin:0 auto;filter:drop-shadow(0 0 24px #0008);} 
  #hint{position:fixed;left:12px;bottom:12px;color:#ddd;font-size:13px;background:rgba(0,0,0,0.25);padding:8px;border-radius:8px}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="hint">Tap level buttons on mobile • Space / ↑ / Tap: action • R: menu</div>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

// --- MOBILE SCALING ---
function resizeCanvas(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize',resizeCanvas);
resizeCanvas();

const W = () => canvas.width;
const H = () => canvas.height;

// --- GAME STATE ---
let gameState = 'menu';
let currentLevel = 1;
let score = 0;
let speedMult = 1;

// --- PLAYER ---
let player = {x:160,y:420,w:32,h:32,vy:0,gravity:0.55,jumpPower:12,onGround:false,jumpCount:0,maxJumps:2,mode:'cube',color:'#00e6ff',trail:[]};

// --- ENTITIES ---
let obstacles = [], decor = [], parallax = [];
let obstacleTimer = 0;

// --- LEVELS ---
const LEVELS = [
  {name:'Neon Classic', palette:['#7a4bff','#2b1b63','#120916'], interval:70, minH:90, maxH:150, speed:4, theme:'tech'},
  {name:'Blue Pulse', palette:['#4bc8ff','#07304d','#021522'], interval:90, minH:80, maxH:140, speed:5, theme:'aquatic'},
  {name:'Solar UFO', palette:['#ff7a33','#3d1200','#2b0f06'], interval:110, minH:60, maxH:120, speed:4.2, theme:'lava'},
  {name:'Emerald Flight', palette:['#4bff8a','#07321a','#02190f'], interval:100, minH:70, maxH:130, speed:5.2, theme:'jungle'},
  {name:'Cyan Wave', palette:['#00fff3','#05343a','#021516'], interval:120, minH:50, maxH:100, speed:5.6, theme:'cyber'}
];

// --- UTILS ---
function rand(a,b){return a+Math.random()*(b-a);} 
function rectIntersect(a,b){return a.x<b.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y}
function roundRect(ctx,x,y,w,h,r,fill,stroke){if(fill)ctx.fillRect(x,y,w,h);if(stroke)ctx.strokeRect(x,y,w,h);}

// --- RESET ---
function resetGame(){
  player.y=H()*0.7;player.vy=0;player.jumpCount=0;player.trail=[];
  obstacles=[];decor=[];parallax=[];obstacleTimer=0;score=0;speedMult=1;
  setPlayerForLevel(currentLevel);
  createDecorForLevel(currentLevel);
}

function setPlayerForLevel(level){
  const lv=LEVELS[level-1];
  switch(level){
    case 1: case 2: player.mode='cube'; player.maxJumps=2; player.color=lv.palette[0]; break;
    case 3: player.mode='UFO'; player.maxJumps=1; player.color=lv.palette[0]; break;
    case 4: player.mode='plane'; player.maxJumps=1; player.color=lv.palette[0]; break;
    case 5: player.mode='wave'; player.maxJumps=0; player.color=lv.palette[0]; break;
  }
}

function createDecorForLevel(level){
  const lv=LEVELS[level-1];
  for(let i=0;i<4;i++) parallax.push({x:0,y:50*i,w:W(),h:H(),speed:0.1*(i+1),color:lv.palette[(i+1)%lv.palette.length],alpha:0.06*(i+1)});
  for(let i=0;i<18;i++) decor.push({x:Math.random()*W()*2-W(),y:Math.random()*H()*0.7,r:10+Math.random()*40,rot:Math.random()*Math.PI,speed:0.1+Math.random()*0.4,color:lv.palette[i%lv.palette.length],alpha:0.07});
}

// --- DRAW PARALLAX ---
function drawParallax(){parallax.forEach(function(layer){ctx.save();ctx.globalAlpha = layer.alpha;ctx.fillStyle = layer.color;ctx.fillRect(layer.x, layer.y, layer.w, layer.h);ctx.restore();});}

// --- DRAW DECOR ---
function drawDecor(){decor.forEach(function(d){ctx.save();ctx.globalAlpha=d.alpha;ctx.fillStyle=d.color;ctx.beginPath();ctx.arc(d.x,d.y,d.r,0,Math.PI*2);ctx.fill();ctx.restore();});}

// --- MENU & DRAW ---
function drawMenu(){
  ctx.fillStyle='#03040a66';ctx.fillRect(0,0,W(),H());
  ctx.fillStyle='#fff';ctx.font='40px Inter, Arial';ctx.fillText('Geometry Dash — Modern',W()*0.15,H()*0.2);
  ctx.font='20px Inter, Arial';ctx.fillText('Tap a level below to play',W()*0.15,H()*0.25);
  for(let i=1;i<=5;i++){
    let x=W()*0.2, y=H()*0.3 + i*60;
    ctx.fillStyle=LEVELS[i-1].palette[0]; ctx.fillRect(x,y-28,220,36);
    ctx.fillStyle='#000'; ctx.font='18px Inter, Arial'; ctx.fillText(i+' - '+LEVELS[i-1].name,x+12,y);
  }
}

// --- TOUCH MENU ---
canvas.addEventListener('touchstart', function(ev){
    ev.preventDefault();
    const touch = ev.touches[0];
    const x = touch.clientX - canvas.getBoundingClientRect().left;
    const y = touch.clientY - canvas.getBoundingClientRect().top;

    if(gameState==='menu'){
        for(let i=1;i<=5;i++){
            let btnX = W()*0.2, btnY = H()*0.3 + i*60 - 28, btnW = 220, btnH = 36;
            if(x >= btnX && x <= btnX+btnW && y >= btnY && y <= btnY+btnH){
                currentLevel = i; resetGame(); gameState='play';
            }
        }
    } else if(gameState==='play'){
        doAction();
    }
},{passive:false});

// --- GAME ACTION ---
function doAction(){
  if(gameState==='menu'||gameState==='dead') return;
  if(player.mode==='cube' && player.jumpCount<player.maxJumps){player.vy=-player.jumpPower; player.jumpCount++;}
  if(player.mode==='UFO') player.vy=-6;
  if(player.mode==='plane') player.vy=-7;
}

document.addEventListener('keydown',function(e){
  if(gameState==='menu' && ['1','2','3','4','5'].includes(e.key)){currentLevel=parseInt(e.key); resetGame(); gameState='play';}
  if(gameState==='play' && (e.key===' '||e.key==='ArrowUp')) doAction();
  if(gameState==='dead' && e.key.toLowerCase()==='r') gameState='menu';
});

// --- RESET + START ---
resetGame();
function update(){
  ctx.clearRect(0,0,W(),H());
  drawParallax(); drawDecor();
  if(gameState==='menu'){drawMenu(); requestAnimationFrame(update); return;}
  requestAnimationFrame(update);
}
update();
</script>
</body>
</html>
