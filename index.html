<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Geometry Dash — V12 with Forest Flight Fixed</title>
<style>
  html,body{height:100%;margin:0;background:#05060d;font-family:Inter, Arial, sans-serif;}
  canvas{display:block;margin:0 auto;}
  #hint{position:fixed;left:12px;bottom:12px;color:#ddd;font-size:13px;background:rgba(0,0,0,0.25);padding:8px;border-radius:8px}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="hint">Tap level buttons on mobile • Tap to jump/use ability • R: return to menu</div>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

function resizeCanvas(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
window.addEventListener('resize',resizeCanvas);
resizeCanvas();

let gameState='menu', currentLevel=1, score=0;
let bestScores = JSON.parse(localStorage.getItem('gd_bestScores')) || [0,0,0,0,0,0];
// Ensure bestScores has 6 entries (for Forest Flight)
while(bestScores.length < 6) bestScores.push(0);
let lastScore=0;

let player={x:160,y:0,w:32,h:32,vy:0,gravity:0.55,jumpPower:12,onGround:false,jumpCount:0,maxJumps:2,mode:'cube',color:'#00e6ff'};
let obstacles=[], decor=[], parallax=[];
let obstacleTimer=0;

const LEVELS=[
  {name:'Neon Classic', palette:['#7a4bff','#2b1b63','#120916'], interval:70, minH:90, maxH:150, speed:4},
  {name:'Blue Pulse', palette:['#4bc8ff','#07304d','#021522'], interval:90, minH:80, maxH:140, speed:5},
  {name:'Solar UFO', palette:['#ff7a33','#3d1200','#2b0f06'], interval:110, minH:60, maxH:120, speed:4.2, midAir:true},
  {name:'Emerald Flight', palette:['#4bff8a','#07321a','#02190f'], interval:100, minH:70, maxH:130, speed:5.2},
  {name:'Cyan Wave', palette:['#00fff3','#05343a','#021516'], interval:120, minH:50, maxH:100, speed:5.6},
  {name:'Forest Flight', palette:['#00ff55','#017a1a','#004d0f'], interval:90, minH:80, maxH:180, speed:4.5, midAir:true}
];

function setPlayerForLevel(level){
  switch(level){
    case 1: case 2: player.mode='cube'; player.maxJumps=2; break;
    case 3: player.mode='UFO'; player.maxJumps=1; break;
    case 4: player.mode='plane'; player.maxJumps=1; break;
    case 5: player.mode='wave'; player.maxJumps=0; break;
    case 6: player.mode='UFO'; player.maxJumps=1; break; // Forest Flight
  }
  player.color=LEVELS[level-1].palette[0];
}

function createDecorForLevel(level){
  const lv=LEVELS[level-1];
  parallax=[]; decor=[];
  for(let i=0;i<4;i++) parallax.push({x:0,y:50*i,w:canvas.width,h:canvas.height,color:lv.palette[i%lv.palette.length],alpha:0.06*(i+1)});
  for(let i=0;i<18;i++) decor.push({x:Math.random()*canvas.width*2-canvas.width,y:Math.random()*canvas.height*0.7,r:10+Math.random()*40,color:lv.palette[i%lv.palette.length],alpha:0.07});
}

function drawParallax(){parallax.forEach(layer=>{ctx.save();ctx.globalAlpha=layer.alpha;ctx.fillStyle=layer.color;ctx.fillRect(layer.x,layer.y,layer.w,layer.h);ctx.restore();});}
function drawDecor(){decor.forEach(d=>{ctx.save();ctx.globalAlpha=d.alpha;ctx.fillStyle=d.color;ctx.beginPath();ctx.arc(d.x,d.y,d.r,0,Math.PI*2);ctx.fill();ctx.restore();});}

function drawMenu(){
  ctx.fillStyle='#03040a66';ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle='#fff';ctx.font='40px Inter, Arial';ctx.fillText('Geometry Dash — Modern',canvas.width*0.15,canvas.height*0.2);
  ctx.font='20px Inter, Arial';ctx.fillText('Tap a level below to play',canvas.width*0.15,canvas.height*0.25);
  for(let i=1;i<=6;i++){
    let x=canvas.width*0.2,y=canvas.height*0.3+i*60;
    ctx.fillStyle=LEVELS[i-1].palette[0]; ctx.fillRect(x,y-28,220,36);
    ctx.fillStyle='#000'; ctx.font='18px Inter, Arial';
    ctx.fillText(i+' - '+LEVELS[i-1].name+' (Best: '+bestScores[i-1]+')',x+12,y);
  }
}

canvas.addEventListener('touchstart', function(ev){
  ev.preventDefault();
  const touch = ev.touches[0];
  const x=touch.clientX-canvas.getBoundingClientRect().left;
  const y=touch.clientY-canvas.getBoundingClientRect().top;
  if(gameState==='menu'){
    for(let i=1;i<=6;i++){
      let btnX=canvas.width*0.2, btnY=canvas.height*0.3+i*60-28, btnW=220, btnH=36;
      if(x>=btnX && x<=btnX+btnW && y>=btnY && y<=btnY+btnH){currentLevel=i; resetGame(); gameState='play';}
    }
  } else if(gameState==='play') doAction();
  else if(gameState==='dead') gameState='menu';
},{passive:false});

document.addEventListener('keydown', function(e){
  if(gameState==='menu' && ['1','2','3','4','5','6'].includes(e.key)){currentLevel=parseInt(e.key); resetGame(); gameState='play';}
  if(gameState==='play' && (e.key===' '||e.key==='ArrowUp')) doAction();
  if(gameState==='dead' && e.key.toLowerCase()==='r') gameState='menu';
});

function doAction(){
  if(player.mode==='cube' && player.jumpCount<player.maxJumps){player.vy=-player.jumpPower; player.jumpCount++;}
  if(player.mode==='UFO') player.vy=-6;
  if(player.mode==='plane') player.vy=-7;
}

function rectIntersect(a,b){return !(a.x+a.w<b.x || a.x>b.x+b.w || a.y+a.h<b.y || a.y>b.y+b.h);}

function spawnObstacles(){
  if(gameState!=='play') return;
  const lv=LEVELS[currentLevel-1]; obstacleTimer++;
  if(obstacleTimer>=lv.interval){
    obstacleTimer=0; let h=lv.minH+Math.random()*(lv.maxH-lv.minH);
    let y=canvas.height-h;
    if(lv.midAir && Math.random()<0.4) y-=150+Math.random()*100;
    obstacles.push({x:canvas.width+50,y:y,w:32,h:h});
  }
}

function updateObstacles(){
  if(gameState!=='play') return;
  const lv=LEVELS[currentLevel-1];
  for(let i=obstacles.length-1;i>=0;i--){
    obstacles[i].x-=lv.speed;
    ctx.fillStyle = (currentLevel===6 ? '#017a1a' : '#ff3333');
    ctx.fillRect(obstacles[i].x,obstacles[i].y,obstacles[i].w,obstacles[i].h);
    if(rectIntersect(player,obstacles[i])) {
      gameState='dead';
      lastScore = score;
      if(lastScore>bestScores[currentLevel-1]){ bestScores[currentLevel-1]=lastScore; localStorage.setItem('gd_bestScores', JSON.stringify(bestScores)); }
    }
    if(obstacles[i].x+obstacles[i].w<0) obstacles.splice(i,1);
  }
}

function resetGame(){
  player.y=canvas.height*0.7; player.vy=0; player.jumpCount=0;
  obstacles=[]; setPlayerForLevel(currentLevel); createDecorForLevel(currentLevel); obstacleTimer=0; score=0;
}

function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height); drawParallax(); drawDecor();
  if(gameState==='menu'){drawMenu(); requestAnimationFrame(update); return;}
  if(gameState==='dead'){
    ctx.fillStyle='white'; ctx.font='30px Inter, Arial';
    ctx.fillText('You Died at Score: '+lastScore+' — Tap or press R to return', canvas.width*0.05, canvas.height*0.5);
    requestAnimationFrame(update); return;
  }

  player.vy+=player.gravity; player.y+=player.vy;
  if(player.y+player.h>canvas.height){player.y=canvas.height-player.h; player.vy=0; player.jumpCount=0;}

  spawnObstacles(); updateObstacles();

  score++; ctx.fillStyle='#fff'; ctx.font='20px Inter, Arial'; ctx.fillText('Score: '+score,12,28);

  if(score>=5000){
    if(score>bestScores[currentLevel-1]){ bestScores[currentLevel-1]=score; localStorage.setItem('gd_bestScores', JSON.stringify(bestScores)); }
    gameState='menu'; alert('Level '+currentLevel+' completed!');
  }

  ctx.fillStyle=player.color; ctx.fillRect(player.x,player.y,player.w,player.h);
  requestAnimationFrame(update);
}

resetGame(); update();
</script>
</body>
</html>

